---
title: 关于红黑树的个人理解
date: 2018-06-14 12:17:29
categories:
	- 算法
tags:
	- 数据结构与算法
---

## 关于这篇文章

在看这篇红黑树的介绍文章之前，您需要对二叉搜索树（BST）及红黑树有一定的了解。对于 2-3-4 树，本文只是借用其表现形式，即使没有学习过 2-3-4 树，相信也不会给您带来阅读上的困难。

这篇文章不会着重介绍如何旋转，只是通过分析**红黑树与 2-3-4 树中插入、删除操作**的联系，以帮助您对红黑树的旋转（rotate）、重着色（recolor）操作有更直观的理解。

## 红黑树的性质

1. 每个结点要么是红色的，要么是黑色的
2. 根结点是黑色的
3. 叶子结点（NIL）是黑色的
4. 红色结点的子结点是黑色的
5. 对于每一个结点，所有简单路径下的黑结点个数相等（黑高度相等）。

<!-- more -->

## 插入

### 三种情况

在 *Introduction to Algorithms* 这本书中，红黑树**插入**操作后的修正有 3 种（左右对称）情况：

- case 1：uncle-aunt 节点是红色的（环形表示红色节点，不过环形太难画了，后面改用方形，望见谅）

  ![微信图片_201807041019151](关于红黑树的个人理解/微信图片_201807041019151-1530670933955.jpg)

- case 2：uncle-aunt 节点是黑色，新插入节点 x 与 uncle-aunt 都是左（右）儿子

  ![微信图片_201807041019152](关于红黑树的个人理解/微信图片_201807041019152.jpg)

- case 3：uncle-aunt 节点是黑色

  ![微信图片_20180704101916](关于红黑树的个人理解/微信图片_20180704101916.jpg)



这几种修正情况是怎么得出来的呢？相信不少同学都有疑问，接下来我以 2-3-4 树的插入为例，解释一下上述三种情况的来历。

> 2-3-4 树，顾名思义，就是每个节点（根节点、NIL 节点除外）必须有 2、3 或 4 个子节点，也就是每个节点可以存储 1 - 3 个 key（键）。
>
> 这里使用横线来表示属于同一 2-3-4 节点的键，方形表示红黑树中的红节点，圆形表示红黑树中的黑节点。

### case 1

依次插入 M、D、R、B 四个键。

![微信图片_20180704101915](关于红黑树的个人理解/微信图片_20180704101915-1530671099046.jpg)

现在出现了一个 5 节点，储存了 B、D、M、R 四个键，不满足 2-3-4 树的性质；B 与 D 同为红色节点，不满足红黑树的性质 4。所以，这时候树要“生长”，来维护树的性质。

![微信图片_20180704104951](关于红黑树的个人理解/微信图片_20180704104951.jpg)

> 注：只有节点的分裂可能会引起 2-3-4 树高度的变化
>
> 又注：2-3-4 树的高度等同于红黑树的黑高度

### case 3

插入新键 A：

![微信图片_20180704105852](关于红黑树的个人理解/微信图片_20180704105852.jpg)

可以看出，A、B、D 三个键组成了一个 4 节点，并没有违反 2-3-4 树的性质，但是 A、B 同为红节点，违反了红黑树的性质 4。所以要进行修正。

![微信图片_20180704110624](关于红黑树的个人理解/微信图片_20180704110624.jpg)

### case 2

依次插入 P、Q：

![微信图片_20180704111550](关于红黑树的个人理解/微信图片_20180704111550.jpg)

P、Q、R 三个键组成的 4 节点未违反 2-3-4 树的性质，但是违反了红黑树的性质 4。

修正：![微信图片_20180704112150](关于红黑树的个人理解/微信图片_20180704112150.jpg)

## 删除

### 四种情况

在 *Introduction to Algorithms* 这本书中，红黑树**删除**操作后的修正有 4 种（左右对称）情况：

- case 1：x（双黑或红黑节点，被删除的节点 z 的非空子节点或 z 的后【前】继 y 的 右【左】儿子）的兄弟节点（sibling）w 是红的
- case 2：w 是黑的，w 的两个子节点都是黑的
- case 3：w 是黑的，w 的左（右）儿子红，右（左）儿子黑
- case 4：w 是黑的，w 的右（左）儿子是红的

![微信图片_20180704114119](关于红黑树的个人理解/微信图片_20180704114119.jpg)

### 简单分析

对于 2-3-4 树来说，删除操作可以简单分成删除叶子节点和删除内部节点（以 z 代替被删除节点）。

其中删除内部节点时，以 z 的直接后（前）继 y 代替 z，而 y 一定在 2-3-4 树的叶子节点，这样就相当于删除了叶子节点中的 y。

下述分析针对叶子节点的删除。

![微信图片_20180705171331](关于红黑树的个人理解/微信图片_20180705171331.jpg)

### case 1

删除 B

![微信图片_20180705172029](关于红黑树的个人理解/微信图片_20180705172029.jpg)

删除 A，进入 case 1 修正部分。

![微信图片_20180705173219](关于红黑树的个人理解/微信图片_20180705173219.jpg)

进入 case 2 修正部分。

![微信图片_20180705173921](关于红黑树的个人理解/微信图片_20180705173921.jpg)

### case 2

删除 P。

![微信图片_20180705174953](关于红黑树的个人理解/微信图片_20180705174953.jpg)

### case 3 & case 4

删除 J。

![微信图片_20180705180135](关于红黑树的个人理解/微信图片_20180705180135.jpg)

## 总结

2-3-4 树的 3 节点对应两种红黑树结构，

![微信图片_20180705180531](关于红黑树的个人理解/微信图片_20180705180531.jpg)

红黑树旋转的本质是把红黑树的结构转换成适合后续操作的 2-3-4 树节点形式。

红黑树的插入、删除操作也与 2-3-4 树的插入、删除大同小异。之所以有那么多的 rotate（旋转）、 recolor（重着色）操作，是因为要保证 2-3-4 树的性质、以 2-3-4 树为基准进行插入删除。

我举的都是比较简单的例子，想要真正理解红黑树，还要**多画图、多写代码**。